<!doctype html>

<link rel="import" href="../vaadin-themable-mixin/vaadin-themable-mixin.html">
<link rel="import" href="../paper-item/paper-icon-item.html">
<link rel="import" href="../iron-collapse-button/iron-collapse-button.html">	
	
<style>
	fc-menuitem.iron-selected > iron-collapse-button > .iron-collapse-button > paper-icon-item {			
		font-weight: var(--paper-item-selected-weight, bold);
	}
</style>
	
<dom-module id="fc-menuitem">
	<template>
		<style>
			:host {
				cursor: pointer;
				display: block;
				--paper-item-disabled-color: var(--lumo-disabled-text-color);
			}
			:host(:not([has-icon])) {
				--paper-item-icon-width: 0;
			}		
			:host(.iron-selected) > iron-collapse-button > paper-icon-item {
				font-weight: var(--paper-item-selected-weight, bold);
			}
			:host paper-icon-item {
				width: 100%;
			}
			:host iron-collapse-button {
				background: inherit;
			}
		</style>
			  	 
		<iron-collapse-button id="iron" no-icons="true">
	  		<paper-icon-item slot="collapse-trigger" role="option" disabled="[[disabled]]">
		  		<iron-icon src="[[image]]" icon="[[icon]]" slot="item-icon"></iron-icon>
		  		<template is="dom-if" if="[[label]]">
		  			<span>[[label]]</span>
		  		</template>
		  		<slot id="slot"></slot>
		  	</paper-icon-item>
 		  	<div slot="collapse-content" class="sub-menu">
		  		<slot id="submenu" name="submenu"></slot>
		  	</div>		  	
	  	</iron-collapse-button>
	  		
	</template>
	
	<script>
		class MenuItem extends Vaadin.ThemableMixin(Polymer.Element) {
	  		static get is() { return 'fc-menuitem'; }
	  		
	  		static get properties() {
		  		return {
		  			key: String,
		  			label : String,
					icon : String,
					image : String,
					disabled: Boolean,
		  			hasIcon: {
		  				type: Boolean,
		  				reflectToAttribute: true,
		  				computed: '__hasIcon(src,icon)'
		  			},
		  			isSubmenu: {
		  				type: Boolean,
		  				reflectToAttribute: true,
		  			}
		  		}
	  		}
	  		
	  		constructor() {
	  		    super();
				var listener = (event) => {
					this.$.iron.$.trigger.children[0].assignedNodes()[0].focus();
				};
				this.addEventListener('focus', listener);
				this.addEventListener('click', listener);
		  		this.addEventListener('mousedown', (event) => {
		  			if (event.button==1) {
		  				event.preventDefault();
						return false;
		  			}
	    		});
	    		this.addEventListener('mouseup', (event) => {	    			
	    			this.dispatchEvent(new CustomEvent('item-click', {bubbles: true, detail: event.button}));
	    			event.preventDefault();
					return false;
	    		});
	    		this.addEventListener('contextmenu', event => {
			  		event.preventDefault();
	    		});
	  		}
	  		
	  		__hasIcon() {
	  			return this.src || this.icon;
	  		}
	  		
	 	    connectedCallback () {
	 	    	super.connectedCallback ();
	  			var handler = this.__bindSubmenu.bind(this);
	  			this.$.slot.addEventListener('slotchange', handler);
	  			setTimeout(handler);
    		}
	 	    
	 	    __bindSubmenu() {
  				this.$.slot.assignedNodes().forEach( e => {
  					if (e.tagName.toLowerCase()==MenuItem.is) {
  						e.slot='submenu';
  					}
  				});

  				this.isSubmenu=this.$.submenu.assignedNodes().length>0;
  				if (this.isSubmenu) {
  					this.$.iron.removeAttribute('no-icons');	  					
  				} else {
  					this.$.iron.setAttribute('no-icons','true');
  				}
  			}
		}
		
		customElements.define(MenuItem.is, MenuItem);
	</script>
</dom-module> 
